template:
  name: coding-team
  description: Multi-agent team with lead, explorer, planner, coder, and reviewer

config:
  providers:
    - name: default
      kind: anthropic
      api_key: ${ANTHROPIC_API_KEY}
      model: claude-sonnet-4-20250514
    - name: openai
      kind: openai
      api_key: ${OPENAI_API_KEY}
      model: gpt-4.1
    - name: grok
      kind: grok
      api_key: ${GROK_API_KEY}
      model: grok-3
    - name: gemini
      kind: gemini
      api_key: ${GEMINI_API_KEY}
      model: gemini-2.5-pro

  agents:
    - name: lead
      description: Stakeholder who owns the outcome, evaluates reports, and makes strategic decisions
      instructions: >-
        You are the lead — you own the outcome of every task. You evaluate
        subagent reports critically, make strategic decisions at each step, and
        ensure the final result meets the user's expectations. You are not a
        dispatcher — you read findings, verify claims using your own tools, and
        decide next actions. MANDATORY: after the planner produces a plan, you
        must present it to the user via ask_user and get explicit approval
        before delegating any coding work. Never skip this approval step.
      provider: default
      toolboxes:
        - filesystem
        - search
        - ask
        - tasks
        - notes
      skills:
        - lead-workflow
      options:
        max_iterations: 20
        max_delegation_depth: 2

    - name: explorer
      description: Gathers codebase intelligence — architecture, patterns, dependencies, relevant files
      instructions: >-
        You are a codebase explorer. Your job is to gather intelligence about the
        codebase — architecture, patterns, dependencies, and relevant files —
        then write a structured findings note for the lead. You never modify
        files.
      provider: default
      toolboxes:
        - filesystem
        - search
        - git
        - notes
      skills:
        - explorer-workflow
      effects:
        - kind: observation_mask
      options:
        max_iterations: 10

    - name: planner
      description: Creates implementation plans based on explorer findings and lead direction
      instructions: >-
        You are a planner. You consume explorer findings and lead direction to
        create detailed implementation plans. Your primary output is a plan note
        — the lead evaluates and approves it before coding begins. If
        requirements are ambiguous, use ask_user to clarify before planning.
      provider: default
      toolboxes:
        - filesystem
        - search
        - git
        - ask
        - tasks
        - notes
      skills:
        - planner-workflow
      effects:
        - kind: observation_mask
      options:
        max_iterations: 10

    - name: coder
      description: Implements code changes per the approved plan
      instructions: >-
        You are a coder. Your first action must always be to read the plan note
        written by the planner. Implement changes based on that plan, stay
        within your assigned file scope, write clean code, and run tests to
        verify your work. Write a thorough result note so the lead can evaluate
        your work.
      provider: default
      toolboxes:
        - filesystem
        - exec
        - search
        - git
        - http
        - tasks
        - notes
      skills:
        - coder-workflow
      effects:
        - kind: loop_detect
        - kind: reflection
        - kind: progress
        - kind: trim_tool_results
        - kind: compact
          params:
            threshold: 0.8
      options:
        max_iterations: 20

    - name: reviewer
      description: Reviews implementation and reports findings to lead
      instructions: >-
        You are a code reviewer. Read the plan note and the coder's result notes,
        then review the changed files against the plan's acceptance criteria.
        Write a review note with your recommendation — the lead makes the final
        accept/reject decision, not you.
      provider: default
      toolboxes:
        - filesystem
        - search
        - exec
        - notes
      skills:
        - reviewer-workflow
      effects:
        - kind: observation_mask
      options:
        max_iterations: 10

  entry_agent: lead

embedded_skills:
  - name: lead-workflow
  - name: explorer-workflow
  - name: planner-workflow
  - name: coder-workflow
  - name: reviewer-workflow
